[![.github/workflows/main.yml](https://github.com/lixiaofei123/lhbin/actions/workflows/main.yml/badge.svg)](https://github.com/lixiaofei123/lhbin/actions/workflows/main.yml)

# lhbin

轻量服务器命令行工具

### 目前支持的命令

- [x] 多账号管理
- [x] 查看地域列表
- [x] 查看流量包详情
- [x] 管理轻量服务器实例
- [x] 管理快照信息
- [x] 查看管理镜像信息
- [x] 管理防火墙信息
- [x] 管理防火墙信息
- [x] 管理密钥对信息 
- [ ] 标签管理(开发中)

目前通过命令行工具可以完成大部分轻量服务器的管理工作。
包括下面功能
 - 对服务器实例进行批量查看、停止、启动、重启、重置镜像、修改密码、回滚快照等等
 - 批量制作快照、管理，删除快照
 - 批量制作镜像、管理，删除快照
 - 查看、修改、删除、重置防火墙规则
 - 查看流量包
 - 查看、创建、导入、删除密钥对，绑定和解绑密钥对
  

### 使用帮助

#### 查看帮助信息

使用下面命令查看帮助信息

```bash
lhbin help
```

输出如图所示

```

本工具目前支持以下命令:

       account       管理账户信息配置，支持多账户
       blueprint       查看管理镜像信息
       firewall       管理防火墙信息
       ins       管理轻量服务器实例信息
       keypair       查看管理密钥对信息
       region       查看地域列表
       snapshot       管理快照信息
       trafficpackage       查看流量包详情

输入 lhbin [命令名称] --help 查看命令帮助信息
```

#### 配置账户

首先查看子命令的account帮助说明

```bash
lhbin account --help
```

输出如下所示

```

管理账户信息配置，支持多账户

       add       添加新的账户
       del       删除指定账户
       list       列出所有账户

输入 lhbin [命令名称] [操作名称]  --help 查看操作帮助信息
```

从输出中可以看到子命令account支持三个操作。首先来查看add操作的帮助。

```bash
lhbin account add --help
```

输出如下所示

```
添加新的账户

Usage of /tmp/go-build1159462923/b001/exe/main:
  -account string
        账号名称，区分多用户使用，可随意指定
  -driver string
        云厂商类型，目前仅支持腾讯云 (default "qqcloud")
  -id string
        密钥ID
  -key string
        密钥key
```

根据命令提示添加新的账户信息

```
lhbin account add --account lixiaofei326 --id AKIDxxxxxxxxxxxxxxxxxxxxxxx --key lFTQ5yyyyyyyyyyyyyyyyyyyyy
```

> 其中 id为腾讯云官网的akid,key为aksecret。请自行到官网申请并给与所需要的权限。


配置了账户信息以后，就可以管理轻量服务器了。

> 用户信息保存在用户目录的 .lhbin/config.yaml文件中。

#### 列出已有的轻量实例

先查看实例子命令支持哪些操作

```bash
lhbin ins --help
```

输出为

```
管理轻量服务器实例信息

       desc       查看指定条件的轻量实例详情
       stop       停止指定条件的轻量实例
       start       启动指定条件的轻量实例
       restart       重启指定条件的轻量实例
       reset       重置指定条件的轻量服务器的镜像
       list       列出指定条件的轻量实例列表

输入 lhbin [命令名称] [操作名称]  --help 查看操作帮助信息
```

然后查看list操作需要传递哪些参数

```bash
lhbin ins list --help
```

输出为

```
列出指定条件的轻量实例列表

Usage of /tmp/go-build3639296214/b001/exe/main:
  -account string
        账号名称，区分多用户使用，可随意指定。不指定则为默认Driver的第一个账号
  -driver string
        云厂商类型，目前仅支持腾讯云，默认为腾讯云 (default "qqcloud")
  -region string
        地域，不填写则默认为所有地域
```

从上面参数中可以看出，account参数默认为第一个指定的用户，driver默认为腾讯云，region参数也可以不填写

> 可以用 lhbin region list 查看当前支持的地域信息

因此，如果列出输出所有轻量服务器，只需要执行下面的命令即可


```bash
lhbin ins list
```

输出为

```
------------------------------------------
| 地域 | 实例名称 | 实例ID | 公网IP | 内网IP | 状态 |
------------------------------------------
| 北京 | Ubuntu-iqII | lhins-xxxx | xxx.xxx.xxx.xxx | 10.0.16.16 | RUNNING |
------------------------------------------
| 北京 | db | lhins-xxxx | xxx.xxx.xxx.xxx| 10.0.8.11 | RUNNING |
------------------------------------------
| 北京 | app | lhins-xxxx | 4xxx.xxx.xxx.xxx| 10.0.8.3 | RUNNING |
------------------------------------------
| 中国香港 | docker-hk | lhins-xxxx | xxx.xxx.xxx.xxx | 10.0.4.8 | RUNNING |
------------------------------------------
| 法兰克福 | 宝塔Linux面板-GAIM | lhins-xxxx | xxx.xxx.xxx.xxx | 10.0.0.11 | RUNNING |
------------------------------------------
详细信息可以通过 lhbin ins desc --region region --insids lhins-xxxxx,lhins-yyyyy 命令进行查看
操作成功.....
```

#### 查看流量包使用情况

```
lhbin tp list
```

输出如下所示

```
--------------------------------------
| 地域 | 实例ID | 总流量 | 已用流量 | 剩余流量 |
------------------------------------------
|ap-beijing|Ubuntu-iqII(lhins-2z923iay)|1000.00 GB|245.76 MB|999.76 GB|
---------------------------------------
|ap-beijing|db(lhins-7l972zgi)|1000.00 GB|51.10 MB|999.95 GB|
---------------------------------------
|ap-beijing|app(lhins-belkzrgs)|500.00 GB|561.15 MB|499.45 GB|
---------------------------------------
|ap-hongkong|docker-hk(lhins-nsp9j3pr)|3.00 TB|30.59 GB|2.97 TB|
---------------------------------------
|eu-frankfurt|宝塔Linux面板-GAIM(lhins-pouwu9vr)|1.00 TB|765.75 MB|1023.25 GB|
---------------------------------------
操作成功.....
```

#### 更多命令

更多命令可以通过运行help命令查看其说明以及用法。


#### 其它说明

为了尽可能减轻误操作带来的影响，lhbin将所有的操作主要分为了三类操作

- 安全操作 不会带来负面影响的操作，例如 列出服务器实例列表、查看服务器实例详情等
- 风险操作 有潜在风险的操作，例如 关闭/重启服务器实例等
- 危险操作 危险操作，例如销毁服务器实例、重置服务器实例等

针对这三种类型操作，lhbin分别有不同的处理逻辑

##### 安全操作

安全的操作在用户输入命令后立即执行


##### 风险操作

在用户输入命令后，会提示用户相关风险，并要求用户输入Y以后才会执行

例如停止实例命令

```
lhbin ins stop --region eu-frankfurt --insid lhins-pouwu9vr
```

输出如下所示

```
警告，下面的操作具有一定的风险性，请谨慎操作:
请确认已经保存好相关的工作
请输入Y来确认是否进行下一步操作（不区分大小写，输入其他任意字符取消操作）:
```

用户输入Y以后，才会继续运行后面的操作，否则会取消相关的操作。如下所示

```
警告，下面的操作具有一定的风险性，请谨慎操作:
请确认已经保存好相关的工作
请输入Y来确认是否进行下一步操作（不区分大小写，输入其他任意字符取消操作）:Y

eu-frankfurt地域的实例(宝塔Linux面板-GAIM)lhins-pouwu9vr停止成功
操作成功.....
```

##### 危险操作

由于危险操作如果误操作可能会造成用户数据丢失甚至财产损失。因此，对于这些操作，需要用户手动输入随机生成的5位验证码方可继续运行。

例如，重置镜像功能

```
lhbin ins reset --region eu-frankfurt --insid lhins-pouwu9vr --imageid lhbp-flkrav7y
```

输出如下所示

```
警告，下面的操作十分具备危险性，如非必要，强烈建议到控制台操作:
重置服务器后无法恢复，请注意备份好相关数据
请输入2f63e来确认是否进行下一步操作（输入错误会取消操作）:
```

用户需要手动输入2f63e(每次都不同)后，才会继续运行后面的操作，否则会取消相关的操作。如下所示

```
警告，下面的操作十分具备危险性，如非必要，强烈建议到控制台操作:
重置服务器后无法恢复，请注意备份好相关数据
请输入544e6来确认是否进行下一步操作（输入错误会取消操作）:544e6

eu-frankfurt地域的实例(宝塔Linux面板-GAIM)lhins-pouwu9vr重置镜像成功
操作成功.....
```

#### 二次确认

部分操作在不执行region以及实例id的情况下，会进行批量操作。例如关机等操作

如果只运行下面的命令，不指定region和insid的话，会对所有的实例进行关机。针对此种情况，会有二次确认步骤，提醒用户可能存在的风险

```bash
lhbin ins stop
```

输出如下所示

```
警告，下面的操作具有一定的风险性，请谨慎操作:
请确认已经保存好相关的工作
请输入Y来确认是否进行下一步操作（不区分大小写，输入其他任意字符取消操作）:Y

未设置地域和实例ID，操作将对所有的实例生效
如果不希望出现此确认步骤，请加上-f参数来强制运行
请输入Y来确认是否进行下一步操作（不区分大小写，输入其他任意字符取消操作）:
```

用户输入Y以后，才会继续运行后面的操作，否则会取消相关的操作。

如果不需要进行二次确认，增加-f参数即可强制运行，如下

```bash
lhbin ins stop -f
```






































